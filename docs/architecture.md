# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ§‹æˆãƒ»ã‚¯ãƒ©ã‚¹è¨­è¨ˆãƒ»å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è²¬å‹™ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
config-lens/
â”œâ”€â”€ main.py                    # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ pyproject.toml             # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šãƒ»ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ taskfile.yml               # ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼å®šç¾©
â”œâ”€â”€ ConfigLens.spec            # PyInstaller ãƒ“ãƒ«ãƒ‰è¨­å®š
â”‚
â”œâ”€â”€ src/                       # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py                 # ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆDiffViewerAppï¼‰
â”‚   â”œâ”€â”€ menu.py                # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ï¼ˆNavigationFrameï¼‰
â”‚   â”œâ”€â”€ utils.py               # æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”œâ”€â”€ compare/               # æ¯”è¼ƒæ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ logic.py           # å·®åˆ†è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ view.py            # æ¯”è¼ƒãƒ“ãƒ¥ãƒ¼ UI
â”‚   â”‚   â”œâ”€â”€ platforms.py       # ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå…±é€šå®šç¾©ï¼‰
â”‚   â”‚   â”œâ”€â”€ ignore.py          # Ignore ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†
â”‚   â”‚   â””â”€â”€ settings.py        # ã‚¢ãƒ—ãƒªè¨­å®šã®æ°¸ç¶šåŒ–
â”‚   â””â”€â”€ validate/              # æ¤œè¨¼æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ logic.py           # æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
â”‚       â””â”€â”€ view.py            # æ¤œè¨¼ãƒ“ãƒ¥ãƒ¼ UI
â”‚
â”œâ”€â”€ tests/                     # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_utils.py
â”‚   â”œâ”€â”€ compare/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_logic.py
â”‚   â”‚   â””â”€â”€ test_ignore.py
â”‚   â”œâ”€â”€ validate/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ test_logic.py
â”‚   â””â”€â”€ fixtures/              # ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
â”‚       â”œâ”€â”€ source.txt
â”‚       â”œâ”€â”€ target.txt
â”‚       â”œâ”€â”€ demo_source.txt
â”‚       â”œâ”€â”€ demo_target.txt
â”‚       â”œâ”€â”€ config/
â”‚       â”œâ”€â”€ eBGP/              # eBGP æ§‹æˆå¤‰æ›´ã‚·ãƒŠãƒªã‚ª
â”‚       â”‚   â”œâ”€â”€ current.txt
â”‚       â”‚   â”œâ”€â”€ input.txt
â”‚       â”‚   â””â”€â”€ after.txt
â”‚       â””â”€â”€ vlan/              # VLAN æ§‹æˆã‚·ãƒŠãƒªã‚ª
â”‚
â”œâ”€â”€ assets/                    # ã‚¢ã‚¤ã‚³ãƒ³ç­‰ã®é™çš„ãƒªã‚½ãƒ¼ã‚¹
â”œâ”€â”€ docs/                      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆæœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
â””â”€â”€ scripts/                   # ãƒ“ãƒ«ãƒ‰è£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â””â”€â”€ generate_icon.py
```

---

## ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ                           â”‚
â”‚  main.py â†’ src/app.py::main()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆUIï¼‰                   â”‚
â”‚  src/app.py        DiffViewerApp            â”‚
â”‚  src/menu.py       NavigationFrame          â”‚
â”‚  src/compare/view.py   CompareView          â”‚
â”‚  src/compare/ignore.py IgnorePatternDialog  â”‚
â”‚  src/validate/view.py  ValidateView         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤                           â”‚
â”‚  src/compare/logic.py                       â”‚
â”‚    HierarchicalDiffAnalyzer                 â”‚
â”‚    TextAlignedDiffComparator                â”‚
â”‚  src/validate/logic.py                      â”‚
â”‚    validate()                               â”‚
â”‚  src/compare/ignore.py                      â”‚
â”‚    IgnorePatternManager                     â”‚
â”‚  src/compare/platforms.py  ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å®šç¾©â”‚
â”‚  src/utils.py   æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤                              â”‚
â”‚  src/compare/settings.py  AppSettings       â”‚
â”‚  â†’ settings.jsonï¼ˆOS ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿é ˜åŸŸï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª¬æ˜

### `main.py`

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚`src/app.py` ã® `main()` ã‚’å‘¼ã³å‡ºã™ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ©ãƒƒãƒ‘ãƒ¼ã§ã™ã€‚

```python
from src.app import main

if __name__ == "__main__":
    main()
```

---

### `src/app.py` â€” `DiffViewerApp`

`customtkinter.CTk` ã‚’ç¶™æ‰¿ã—ãŸãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

| è¦ç´  | èª¬æ˜ |
|---|---|
| `_settings: AppSettings` | ã‚¢ãƒ—ãƒªå…¨ä½“ã§å…±æœ‰ã™ã‚‹è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ |
| `_nav_frame: NavigationFrame` | å·¦åˆ—ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ |
| `_compare_view: CompareView` | å³åˆ—ã®æ¯”è¼ƒãƒ“ãƒ¥ãƒ¼ |
| `_show_compare_view()` | æ¯”è¼ƒãƒ“ãƒ¥ãƒ¼ã‚’å‰é¢ã«è¡¨ç¤ºï¼ˆå°†æ¥ã®å¤šãƒ“ãƒ¥ãƒ¼åˆ‡æ›¿ã«å‚™ãˆãŸè¨­è¨ˆï¼‰ |

ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®åˆæœŸã‚µã‚¤ã‚ºã¯ `1400Ã—800` px ã§ã€å¤–è¦³ã¯ `dark` ãƒ¢ãƒ¼ãƒ‰ã€ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã¯ `dark-blue` ã§ã™ã€‚

**ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé…ç½®ï¼ˆgridï¼‰**

```
column 0 (weight=0, å›ºå®šå¹…)   column 1 (weight=1, å¯å¤‰å¹…)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NavigationFrame   â”‚  CompareView                    â”‚
â”‚   (row=0, col=0)   â”‚   (row=0, col=1)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### `src/menu.py` â€” `NavigationFrame`

ã‚¢ãƒ—ãƒªå·¦å´ã«å›ºå®šè¡¨ç¤ºã•ã‚Œã‚‹ç¸¦å‹ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã§ã™ã€‚

| è¦ç´  | èª¬æ˜ |
|---|---|
| `_on_compare: Callable[[], None]` | æ¯”è¼ƒãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| `_create_widgets()` | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’æ§‹ç¯‰ã™ã‚‹å†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ |

ç¾åœ¨ã¯ã€ŒText Diff Viewerã€ãƒœã‚¿ãƒ³1ã¤ã®ã¿ã§ã™ã€‚æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã“ã“ã«ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

---

### `src/utils.py` â€” ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

éšå±¤æ§‹é€ ã®è§£æã«å¿…è¦ãªæ±ç”¨é–¢æ•°ã‚’æä¾›ã—ã¾ã™ã€‚

#### `calculate_hierarchical_path(config: list[str]) -> list[list[str]]`

ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®å„è¡Œã«ã¤ã„ã¦ã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆé‡ã‹ã‚‰éšå±¤ãƒ‘ã‚¹ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

```python
# å…¥åŠ›
config = [
    "interface GigabitEthernet0/1",
    " ip address 192.168.1.1 255.255.255.0",
    "interface GigabitEthernet0/2",
]

# å‡ºåŠ›
[
    ["interface GigabitEthernet0/1"],
    ["interface GigabitEthernet0/1", "ip address 192.168.1.1 255.255.255.0"],
    ["interface GigabitEthernet0/2"],
]
```

#### `remove_plus_minus_from_diff_line(diff_line: str) -> str`

`unified_diff` ãŒå‡ºåŠ›ã™ã‚‹ `+` / `-` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’é™¤å»ã—ã¾ã™ã€‚ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã¯ä¿æŒã•ã‚Œã¾ã™ã€‚

---

### `src/compare/` â€” æ¯”è¼ƒæ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤

æ¯”è¼ƒæ©Ÿèƒ½ã«é–¢ã™ã‚‹ã‚³ãƒ¼ãƒ‰ç¾¤ã§ã™ã€‚UIãƒ»ãƒ­ã‚¸ãƒƒã‚¯ãƒ»Ignore ç®¡ç†ãƒ»è¨­å®šæ°¸ç¶šåŒ–ã®4ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

#### `src/compare/logic.py` â€” å·®åˆ†è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

##### `HierarchicalDiffAnalyzer`

`hier_config` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®**æ§‹é€ çš„å·®åˆ†**ã‚’è§£æã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---|---|
| `analyze_structural_diff(source, target)` | è¿½åŠ è¡Œãƒ»å‰Šé™¤è¡Œãƒ»å¤‰æ›´ãªã—è¡Œã®éšå±¤ãƒ‘ã‚¹ãƒªã‚¹ãƒˆã‚’è¿”ã™ |

æˆ»ã‚Šå€¤ã®è¾æ›¸æ§‹é€ ï¼š

```python
{
    "additional_parts": [[...], ...],   # target ã«ã®ã¿å­˜åœ¨
    "deletional_parts": [[...], ...],   # source ã«ã®ã¿å­˜åœ¨
    "non_changed_parts": [[...], ...],  # ä¸¡æ–¹ã«å­˜åœ¨
}
```

##### `TextAlignedDiffComparator`

2ã¤ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œå˜ä½ã§æ¯”è¼ƒã—ã€WinMerge ã®ã‚ˆã†ã«**é«˜ã•ã‚’æƒãˆãŸ**è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚ã™ã¹ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---|---|
| `compare_and_align(source, target)` | é«˜ã•ã‚’æƒãˆãŸ `(sourceè¡Œãƒªã‚¹ãƒˆ, targetè¡Œãƒªã‚¹ãƒˆ)` ã‚’è¿”ã™ |
| `compare_and_align_with_diff_info(source, target)` | ä¸Šè¨˜ã«åŠ ãˆå·®åˆ†ã‚¿ã‚¤ãƒ—ãƒªã‚¹ãƒˆã‚’è¿”ã™ |
| `compare_and_align_with_structural_diff_info(source, target, platform)` | æ§‹é€ çš„å·®åˆ†ã«åŸºã¥ããƒã‚¤ãƒ©ã‚¤ãƒˆæƒ…å ±ä»˜ãã§è¿”ã™ |

**å·®åˆ†ã‚¿ã‚¤ãƒ—ä¸€è¦§**

| ã‚¿ã‚¤ãƒ— | æ„å‘³ |
|---|---|
| `equal` | ä¸¡æ–¹ã«å­˜åœ¨ã—é †ç•ªã‚‚ä¸€è‡´ |
| `delete` | source ã«ã®ã¿å­˜åœ¨ï¼ˆå‰Šé™¤ï¼‰ |
| `insert` | target ã«ã®ã¿å­˜åœ¨ï¼ˆè¿½åŠ ï¼‰ |
| `replace` | å†…å®¹ãŒç•°ãªã‚‹è¡Œï¼ˆãƒ†ã‚­ã‚¹ãƒˆå·®åˆ†ï¼‰ |
| `reorder` | ä¸¡æ–¹ã«å­˜åœ¨ã™ã‚‹ãŒè¨˜è¼‰é †ãŒç•°ãªã‚‹ï¼ˆæ§‹é€ çš„å·®åˆ†ï¼‰ |
| `empty` | ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ç”¨ã®ç©ºè¡Œ |

**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¦‚è¦**

1. å„è¡Œã®éšå±¤ãƒ‘ã‚¹ã‚’ `calculate_hierarchical_path()` ã§è¨ˆç®—ã—ã€`" > "` ã§çµåˆã—ãŸã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ã€‚  
   ä¾‹: `"interface GigabitEthernet0/0 > ip address 10.0.0.1 255.255.255.0"`
2. `difflib.SequenceMatcher` ã§ã‚­ãƒ¼ã‚’æ¯”è¼ƒã—ã€`equal / replace / delete / insert` ã® opcodes ã‚’å–å¾—ã™ã‚‹ã€‚
3. opcodes ã«å¾“ã£ã¦ç©ºè¡Œï¼ˆãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã‚’æŒ¿å…¥ã—ã€å·¦å³ã®è¡Œæ•°ã‚’æƒãˆã‚‹ã€‚
4. æ§‹é€ çš„å·®åˆ†ãƒ¢ãƒ¼ãƒ‰ã§ã¯ `hier_config` ã®è§£æçµæœã¨çªãåˆã‚ã›ã¦ `reorder` ã‚’åˆ¤å®šã™ã‚‹ã€‚

---

#### `src/compare/platforms.py` â€” ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°

`CompareView` ã¨ `ValidateView` ãŒå…±æœ‰ã™ã‚‹ GUI é¸æŠè‚¢å â†’ `Platform` åˆ—æŒ™å‹ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ä¸€å…ƒç®¡ç†ã—ã¾ã™ã€‚

```python
PLATFORM_MAP: dict[str, Platform] = {
    "CISCO_IOS": Platform.CISCO_IOS,
    "CISCO_NXOS (Not Supported)": Platform.CISCO_NXOS,
    ...
}
```

`"(Not Supported)"` ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯å°†æ¥å®Ÿè£…äºˆå®šã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ç¤ºã—ã€ç¾æ™‚ç‚¹ã§ã¯ `CISCO_IOS` ã®ã¿ãŒå®Ÿç”¨ãƒ¬ãƒ™ãƒ«ã§å‹•ä½œã—ã¾ã™ã€‚

---

### `src/validate/` â€” æ¤œè¨¼æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤

Config Validator æ©Ÿèƒ½ã«é–¢ã™ã‚‹ã‚³ãƒ¼ãƒ‰ç¾¤ã§ã™ã€‚ãƒ­ã‚¸ãƒƒã‚¯ã¨ UI ã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

#### `src/validate/logic.py` â€” æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯

##### `ValidateResult`

æ¤œè¨¼çµæœã‚’ä¿æŒã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ |
|---|---|---|
| `running_lines` | `list[str]` | æ•´åˆ—å¾Œã® running-config è¡¨ç¤ºç”¨è¡Œãƒªã‚¹ãƒˆ |
| `expected_lines` | `list[str]` | æ•´åˆ—å¾Œã® expected running-config è¡¨ç¤ºç”¨è¡Œãƒªã‚¹ãƒˆ |
| `change_lines` | `list[str]` | è¨­å®šå¤‰æ›´å†…å®¹ã®ç”Ÿè¡Œãƒªã‚¹ãƒˆ |
| `running_types` | `list[str]` | running_lines ã®å„è¡Œã‚¿ã‚¤ãƒ— |
| `expected_types` | `list[str]` | expected_lines ã®å„è¡Œã‚¿ã‚¤ãƒ— |
| `change_types` | `list[str]` | change_lines ã®å„è¡Œã‚¿ã‚¤ãƒ— |
| `change_to_running` | `dict[int, list[int]]` | changeè¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ â†’ runningåˆ—è¡Œç•ªå·ãƒªã‚¹ãƒˆ |
| `change_to_expected` | `dict[int, list[int]]` | changeè¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ â†’ expectedåˆ—è¡Œç•ªå·ãƒªã‚¹ãƒˆ |
| `is_valid` | `bool` | èª¬æ˜ã§ããªã„å·®åˆ†ãŒãªã„å ´åˆ True |
| `has_unapplied_change` | `bool` | å¤‰æ›´å†…å®¹ãŒå·®åˆ†ã«å¯¾å¿œã—ã¦ã„ãªã„å ´åˆ True |

**è¡Œã‚¿ã‚¤ãƒ—ä¸€è¦§**

| ã‚¿ã‚¤ãƒ— | åˆ— | æ„å‘³ |
|---|---|---|
| `equal` | running / expected | ä¸¡æ–¹ã«å­˜åœ¨ã—å·®åˆ†ãªã— |
| `change_remove` | running | è¨­å®šå¤‰æ›´å†…å®¹ã§èª¬æ˜ã§ãã‚‹å‰Šé™¤ï¼ˆâš ï¸ é»„è‰²ï¼‰ |
| `remove` | running | èª¬æ˜ã§ããªã„å‰Šé™¤ï¼ˆğŸ”´ èµ¤ = æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ï¼‰ |
| `change_add` | expected | è¨­å®šå¤‰æ›´å†…å®¹ã§èª¬æ˜ã§ãã‚‹è¿½åŠ ï¼ˆâš ï¸ é»„è‰²ï¼‰ |
| `add` | expected | èª¬æ˜ã§ããªã„è¿½åŠ ï¼ˆğŸŸ¢ ç·‘ = æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ï¼‰ |
| `reorder` | running / expected | è¨˜è¼‰é †ãŒç•°ãªã‚‹è¡Œ |
| `empty` | running / expected | ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ç”¨ç©ºè¡Œ |
| `normal` | change | å·®åˆ†ã«å¯¾å¿œã—ãªã„å¤‰æ›´è¡Œ |
| `change` | change | å·®åˆ†ã«å¯¾å¿œã™ã‚‹å¤‰æ›´è¡Œï¼ˆâš ï¸ é»„è‰²ãƒ»ã‚¯ãƒªãƒƒã‚¯å¯ï¼‰ |
| `unmatched` | change | å·®åˆ†ã«å¯¾å¿œã—ãªã„å¤‰æ›´è¡Œï¼ˆã‚°ãƒ¬ãƒ¼ = æƒ³å®šæ¼ã‚Œï¼‰ |

##### `validate(running_text, change_text, expected_text, platform)`

3ã¤ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¤œè¨¼ã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°ã§ã™ã€‚

**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¦‚è¦**

1. `TextAlignedDiffComparator.compare_and_align_with_structural_diff_info()` ã§ running â†” expected ã®æ§‹é€ çš„å·®åˆ†ã‚’è¨ˆç®—ã™ã‚‹ã€‚
2. `_build_change_key_maps()` ã§ change ã®å„è¡Œã‹ã‚‰ `add_key_map` / `remove_key_map`ï¼ˆéšå±¤ãƒ‘ã‚¹ã‚­ãƒ¼ â†’ è¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚
3. å„å·®åˆ†è¡Œã®éšå±¤ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’ã‚­ãƒ¼ãƒãƒƒãƒ—ã¨ç…§åˆã—ã€ä¸€è‡´ã™ã‚Œã° `change_remove` / `change_add`ã€ä¸ä¸€è‡´ãªã‚‰ `remove` / `add` ã«åˆ†é¡ã™ã‚‹ã€‚
4. `is_valid = "remove" not in running_types and "add" not in expected_types` ã§æœ‰åŠ¹æ€§ã‚’åˆ¤å®šã™ã‚‹ã€‚

---

#### `src/validate/view.py` â€” æ¤œè¨¼ãƒ“ãƒ¥ãƒ¼ UI

##### `ValidateView`

`ctk.CTkFrame` ã‚’ç¶™æ‰¿ã—ãŸ3åˆ—æ§‹æˆã®æ¤œè¨¼ãƒ“ãƒ¥ãƒ¼ã§ã™ã€‚

**åˆ—æ§‹æˆ**

| åˆ— | å†…å®¹ | ãƒã‚¤ãƒ©ã‚¤ãƒˆ |
|---|---|---|
| å·¦ | ç¾åœ¨ã® running-config | change_remove: é»„ã€remove: èµ¤ |
| ä¸­å¤® | è¨­å®šå¤‰æ›´å†…å®¹ | change: é»„ï¼ˆã‚¯ãƒªãƒƒã‚¯å¯ï¼‰ã€unmatched: ã‚°ãƒ¬ãƒ¼ |
| å³ | æƒ³å®šã•ã‚Œã‚‹ running-config | change_add: é»„ã€add: ç·‘ |

**ä¸»è¦ãªãƒ¡ã‚½ãƒƒãƒ‰**

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---|---|
| `_create_toolbar()` | ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠÃ—3ãƒ»Platformãƒ»Validate ãƒœã‚¿ãƒ³ã‚’æ§‹ç¯‰ |
| `_create_main_area()` | 3åˆ—ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’æ§‹ç¯‰ |
| `_on_validate()` | Validate ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®æ¤œè¨¼å®Ÿè¡Œ |
| `_render_result()` | æ¤œè¨¼çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«åæ˜  |
| `_on_change_click()` | change åˆ—ã‚¯ãƒªãƒƒã‚¯æ™‚ã®é€£å‹•ãƒã‚¤ãƒ©ã‚¤ãƒˆ |
| `_apply_inline_char_diffs()` | æ–‡å­—å˜ä½ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆ |

---

`CompareView` ã‚¯ãƒ©ã‚¹ãŒæ¯”è¼ƒæ©Ÿèƒ½ã® UI å…¨ä½“ã‚’ç®¡ç†ã—ã¾ã™ã€‚

| å†…éƒ¨çŠ¶æ…‹ | èª¬æ˜ |
|---|---|
| `source_file_path / target_file_path` | é¸æŠä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ |
| `_src_key_to_row / _tgt_key_to_row` | éšå±¤ãƒ‘ã‚¹ã‚­ãƒ¼ â†’ è¡Œç•ªå·ã®ãƒãƒƒãƒ—ï¼ˆã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒ³ãƒ—ç”¨ï¼‰ |
| `_src_types / _tgt_types` | æ¯”è¼ƒæ¸ˆã¿ã®å·®åˆ†ã‚¿ã‚¤ãƒ—ãƒªã‚¹ãƒˆ |
| `_ignore_manager` | Ignore ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†ã‚¯ãƒ©ã‚¹ |
| `_ignore_enabled_var` | Ignore æœ‰åŠ¹/ç„¡åŠ¹ã® BooleanVar |
| `_has_compared` | æ¯”è¼ƒæ¸ˆã¿ãƒ•ãƒ©ã‚°ï¼ˆIgnore ãƒˆã‚°ãƒ«æ™‚ã®è‡ªå‹•å†æ¯”è¼ƒã«ä½¿ç”¨ï¼‰ |

**ä¸»è¦ãªãƒ¡ã‚½ãƒƒãƒ‰**

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---|---|
| `_create_widgets()` | ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’æ§‹ç¯‰ |
| `_open_source_file() / _open_target_file()` | ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã |
| `_compare_files()` | æ¯”è¼ƒã‚’å®Ÿè¡Œã—ã¦çµæœã‚’æç”»ã™ã‚‹ |
| `_apply_ignore(text)` | Ignore ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚‹è¡Œã‚’ç©ºè¡Œã«ç½®æ›ã™ã‚‹ |
| `_render_diff(...)` | å·®åˆ†çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«æç”»ã™ã‚‹ |
| `_on_ignore_toggle(...)` | Ignore ã‚¹ã‚¤ãƒƒãƒå¤‰æ›´æ™‚ã«è‡ªå‹•å†æ¯”è¼ƒã‚’è¡Œã† |

**ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å·®åˆ†ãƒã‚¤ãƒ©ã‚¤ãƒˆ**

`_INLINE_DIFF_THRESHOLD = 0.4` ä»¥ä¸Šã®é¡ä¼¼åº¦ã‚’æŒã¤ `replace` è¡Œã«å¯¾ã—ã¦ã€`difflib.SequenceMatcher` ã§æ–‡å­—å˜ä½ã®å·®åˆ†ã‚’è¨ˆç®—ã—ãƒã‚¤ãƒ©ã‚¤ãƒˆã—ã¾ã™ã€‚

---

#### `src/compare/ignore.py` â€” Ignore ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†

##### `IgnorePatternManager`

Ignore å¯¾è±¡ã®æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---|---|
| `get_patterns()` | ç™»éŒ²æ¸ˆã¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒªã‚¹ãƒˆã‚’è¿”ã™ï¼ˆã‚³ãƒ”ãƒ¼ï¼‰ |
| `add_pattern(pattern)` | ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ ãƒ»ä¿å­˜ã™ã‚‹ã€‚é‡è¤‡ãƒ»ç©ºãƒ»ç„¡åŠ¹æ­£è¦è¡¨ç¾ã¯ä¾‹å¤–ã‚’é€å‡º |
| `remove_pattern(pattern)` | ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‰Šé™¤ãƒ»ä¿å­˜ã™ã‚‹ |
| `matches(line)` | è¡Œãƒ†ã‚­ã‚¹ãƒˆãŒã„ãšã‚Œã‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚‹ã‹åˆ¤å®šã™ã‚‹ |

è¨­å®šã®ä¿å­˜å…ˆã¯ `AppSettings` ã‚’é€šã˜ã¦ `settings.json` ã® `compare.ignore.patterns` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

##### `IgnorePatternDialog`

`ctk.CTkToplevel` ã‚’ç¶™æ‰¿ã—ãŸãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è¦§è¡¨ç¤ºãƒ»è¿½åŠ ãƒ»å‰Šé™¤ UI ã‚’æä¾›ã—ã¾ã™ã€‚

---

#### `src/compare/settings.py` â€” ã‚¢ãƒ—ãƒªè¨­å®šã®æ°¸ç¶šåŒ–

##### `AppSettings`

ã‚¢ãƒ—ãƒªå…¨ä½“ã®è¨­å®šã‚’ JSON ãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸€å…ƒç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---|---|
| `get(*keys, default=None)` | ãƒã‚¹ãƒˆã—ãŸã‚­ãƒ¼ãƒ‘ã‚¹ã§è¨­å®šå€¤ã‚’å–å¾—ã™ã‚‹ |
| `update(section_path, value)` | æŒ‡å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ã®å€¤ã‚’æ›´æ–°ã—ã¦ä¿å­˜ã™ã‚‹ |
| `settings_path` | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®çµ¶å¯¾ãƒ‘ã‚¹ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ |

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ **

```json
{
  "compare": {
    "ignore": {
      "patterns": [
        "^!",
        "^Building configuration"
      ]
    }
  }
}
```

æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€å¯¾å¿œã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã¨å…±å­˜ã§ãã¾ã™ã€‚

**ä¿å­˜å…ˆ**

| OS | ãƒ‘ã‚¹ |
|---|---|
| macOS | `~/Library/Application Support/ConfigLens/settings.json` |
| Windows | `%APPDATA%\ConfigLens\settings.json` |
| Linux | `~/.local/share/ConfigLens/settings.json` |

---

## ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ç”¨é€” |
|---|---|
| `customtkinter` | ãƒ¢ãƒ€ãƒ³ãª Tkinter ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒå¯¾å¿œ GUIï¼‰ |
| `hier-config` | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®éšå±¤æ§‹é€ è§£æãƒ»å·®åˆ†è¨ˆç®— |
| `platformdirs` | OS æ¨™æº–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå–å¾— |
| `PyInstaller` | ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ“ãƒ«ãƒ‰ |

---

## ã‚¯ãƒ©ã‚¹é–¢ä¿‚å›³

```
DiffViewerApp (CTk)
â”œâ”€â”€ NavigationFrame (CTkFrame)
â”‚   â””â”€â”€ [CTkButton callbacks: compare / validate]
â”œâ”€â”€ CompareView (CTkFrame)
â”‚   â”œâ”€â”€ IgnorePatternManager
â”‚   â”‚   â””â”€â”€ AppSettings  â†â†’  settings.json
â”‚   â”œâ”€â”€ IgnorePatternDialog (CTkToplevel)  [ãƒ¢ãƒ¼ãƒ€ãƒ«]
â”‚   â””â”€â”€ TextAlignedDiffComparator  [static methods]
â”‚       â””â”€â”€ HierarchicalDiffAnalyzer  [static methods]
â”‚           â””â”€â”€ hier_config (HConfig, get_hconfig)
â””â”€â”€ ValidateView (CTkFrame)
    â””â”€â”€ validate()  [function]
        â”œâ”€â”€ TextAlignedDiffComparator  [å†åˆ©ç”¨]
        â””â”€â”€ _build_change_key_maps()  [å†…éƒ¨é–¢æ•°]
```
